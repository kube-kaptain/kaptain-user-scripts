#!/usr/bin/env bash
# SPDX-License-Identifier: MIT
# Copyright (c) 2025-2026 Kaptain contributors (Fred Cooke)
#
# Kaptain CLI wrapper - routes subcommands to kaptain-<subcommand>
#
# Usage: kaptain <subcommand> [args...]
#        kaptain decrypt [--type TYPE] [--dir DIR]
#        kaptain encrypt [--type TYPE] [--dir DIR]
#        kaptain help
#        kaptain --help | -h

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

show_help() {
  exec "${SCRIPT_DIR}/kaptain-help" "$@"
}

if [[ $# -eq 0 ]]; then
  show_help
  exit 0
fi

subcommand="$1"
shift

case "${subcommand}" in
  -h|--help|help)
    show_help "$@"
    ;;
  *)
    # Delegate to kaptain-<subcommand> in same directory
    subcmd="${SCRIPT_DIR}/kaptain-${subcommand}"
    if [[ -x "${subcmd}" ]]; then
      exec "${subcmd}" "$@"
    else
      echo "ERROR: Unknown subcommand '${subcommand}'" >&2
      echo "Run 'kaptain help' for available commands." >&2
      exit 1
    fi
    ;;
esac
